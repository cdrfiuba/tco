\documentclass[a4paper,12pt]{article}	%Hoja A4, tamaño de letra 12 puntos
\usepackage[latin1]{inputenc}		%Encoding del archivo de texto plano (txt), así podés escribir letras con diacríticas 
\usepackage[T1]{fontenc}		%Encoding de la fuente
\usepackage[spanish]{babel} 		%Estilos, hyphenation y nombres de entornos (abstract-->resumen) en español
\usepackage{times}			%Para agregar la fecha al documento		
\usepackage{amsmath}			%Simbolos matemáticos que sino no funcionan
\usepackage{amssymb}             	%Simbolos matemáticos que sino no funcionan
\usepackage{amsfonts}            	%Fuentes extras para modo mátemático
\usepackage{units}               	%Para agregar unidades y fracciones con formato especial
\usepackage{esint}               	%Para integrales dobles cerradas
%\usepackage{wasysym}            	%Para integrales dobles cerradas (no tan lindo como las de `esint')
%\usepackage{pdfpages}			%Para incluir otros pdfs, en un nuestro documento Latex
%\usepackage{eso-pic}
%\usepackage{everyshi}
%\usepackage{ifthen}
%\usepackage{calc}
%\usepackage{watermark}          	%Permite incluir marcas de agua
\usepackage{float}               	%Permite fijar una figura a un lugar específico del archivo con el parámetro [H] 
\usepackage{fancyhdr}			%Manejo enriquecido de encabezados y pie de página
\usepackage{fancybox}            	%Permite agregar marcos especiales en las páginas
%\usepackage{anysize}			%Habilita el comando \marginsize{left}{right}{top}{bottom}
%\usepackage{mathptmx}			%Tipografía Times
\usepackage{graphicx}
%\usepackage[pdflatex]{graphicx}	%Permite incluir imágenes en el documento. Usando ``dvipdfm'' se pueden manejar archivos jpg, jpeg, png, y pdf. Pero hay que generar un archivo .bb que contiene el tamaño de la imagen entre otros datos. Para eso miktex-->bin-->ebb.exe 
\usepackage{threeparttable}		%Permite agregar notas al pie en tablas
\usepackage{cancel}			%Permite tachar cosas en modo matemático
					%hyperref posibilita referencia internas y externas, a continuacion las opciones de config:
\usepackage[a4paper,
         	dvipdfm,             	%Usar sólo si después se va a pasar de dvi a pdf
		%dvips,%		%Usar si se va a trabajar en dvi, o si después se va a pasar de dvi a ps (y eventualmente de ps a pdf ---pero ojo que los enlaces quedan más lindos si se pasa directamente de dvi a pdf, usando dvipdfm)
		pdfdisplaydoctitle=true,%Muestra el título en el marco superior de la ventana del visor de pdf
		colorlinks=true,     	%Al encender esta función, ya nohay recuadros feos alrededor de los links
		pdfnewwindow=true,   	%Para que el link a nuevos pdf, no se abran en la misma ventana
		linkcolor=black,     	%Color para links internos
		citecolor=green,     	%Color para links a Bibliografia
           	filecolor=blue,      	%Color para links a archivos
		pdftitle={Proyecto (66.09) [Junio 2010] - Robótica Colaborativa},
		pdfauthor={Manuel I. Fernandez, Marcela F. Luberto y Sebastián García Marra}]
		{hyperref}

\usepackage{color}				
\usepackage{listings}		%Este paquete es para poder insertar codigo en el informe y su respectivo set
\lstset{ 
language=C++,                	% choose the language of the code
basicstyle=\footnotesize,       % the size of the fonts that are used for the code
numbers=left,                   % where to put the line-numbers
numberstyle=\footnotesize,      % the size of the fonts that are used for the line-numbers
stepnumber=1,                   % the step between two line-numbers. If it is 1 each line will be numbered
numbersep=5pt,                  % how far the line-numbers are from the code
backgroundcolor=\color{white},  % choose the background color. You must add \usepackage{color}
showspaces=false,               % show spaces adding particular underscores
showstringspaces=false,         % underline spaces within strings
showtabs=false,                 % show tabs within strings adding particular underscores
frame=single,         		% adds a frame around the code
tabsize=2,         		% sets default tabsize to 2 spaces
captionpos=b,           	% sets the caption-position to bottom
breaklines=true,        	% sets automatic line breaking
breakatwhitespace=false,    	% sets if automatic breaks should only happen at whitespace
escapeinside={\%*}{*)}          % if you want to add a comment within your code
}
					


\newcommand{\autor}[3]{\vspace{5mm}%
											{\bf #1}\\%
											{\bf Padrón:} #2\\%
											\texttt{#3}\\}


%Determinación del estilo de página (encabezado y pie)

\lhead{\small Proyecto (66.09) [Junio 2013]}
\chead{}
\rhead{\small TCO}
\rfoot{}
\cfoot{Página {\thepage}}
\lfoot{}

%Manejo de márgenes

%\marginsize{left}{right}{top}{bottom}
\addtolength{\textwidth}{2cm}  		%Agrega 2cm al ancho por defecto (usado junto con hoffset, no se pierde el centrado)
\addtolength{\hoffset}{-1cm}   		%Quita 1cm al margen, pero mantiene la relación repecto de cada margen
\addtolength{\textheight}{2cm}
\addtolength{\voffset}{-1cm}
\setlength{\headheight}{14pt}


%Manejo de contadores (counters)

%\setcounter{tocdepth}{2}		%Profundidad de la aparición de las secciones en el índice:
					%-1 Part, 0 Chapter, 1 Section, 2 Subsection, 3 Subsubsection, 4 Titled

\setcounter{secnumdepth}{1}  		%Profundidad en la enumeración de las secciones:
%-1 Part, 0 Chapter, 1 Section, 2 Subsection, 3 Subsubsection, 4 Titled paragraph, 5 Titled subparagraph %paragraph, 5 Titled subparagraph


%==================================== Comienzo del documento ===================================
 
\begin{document}	
					
%========================================== Caratula ===========================================

\pagestyle{fancy}

	
%===============================================================================================

%=========================================== Presentación ======================================

\newpage
%Empiezo la caratula
\setlength{\unitlength}{0.5 cm}
\thispagestyle{empty}
\begin{figure}[H]
  \centering
    \includegraphics[width=0.5\textwidth]{img/fiuba.eps}
  %\caption{Texto abajo de la foto}
\end{figure}
\vspace{2cm}
\begin{center}
\textbf{\LARGE Laboratorio de Microcomputadoras [66.09]}\\
\vspace{1cm}
{\Large \textbf{ Proyecto TCO\\[1.25cm]}}
\begin{figure}[H]
  \centering
    \includegraphics{img/portada.eps}
  %\caption{Texto abajo de la foto}
\end{figure}
\vspace{1cm}
{\textbf{Primer Cuatrimestre 2013\\[1.25cm]
}}
%\vspace{1cm}
\begin{tabbing}
\hspace*{3cm} \= \hspace*{3cm} \= \hspace*{3cm}\= \hspace*{3cm} \kill
\textbf{Nombre} \> \textbf{Apellido} \> \textbf{Padrón} \> \textbf{Mail} \\
 \>  \>  \>  \\
Sebastian \> Cerone \> 90259 \> sebascerone@gmail.com\\
Gisela \> Farace \> 92457 \> gisela.farace@gmail.com\\
Ignacio L. J. \> Carballeda \> 91646\> carballeda.ignacio@gmail.com\\
\end{tabbing}
\end{center}
\newpage

%===============================================================================================

%=========================================== Indice ============================================
\newpage

\tableofcontents							

\newpage

%=========================================== Informe ===========================================

\section{Motivación}

	Este desarrollo surge como un proyecto extracurricular del \emph{Club de Robótica} de la \emph{Facultad de Ingeniería de la Universidad de Buenos Aires} a realizarse dentro del ambito \emph{Laboratorio Abierto (LABI)}.

	Desde el año 2011, el \emph{Club de Robótica} realiza una competencia anual de robótica. 
	Primero empezó con una carrera de robot velocistas; que consiste en que un robot realice por sus propios medios, en el menor tiempo posible, un recorrido delimitado por una linea blanca sobre una superficie negra. Al año siguiente, se incorporó la competencia de "Mini-sumo"; en donde dos robots se enfrentan, cual luchadores de sumo, y tienen que sacar al oponente de un "tatami". Finalmente, este año, se incorporó la competencia "Laberinto", en donde un robot, en el menor tiempo posible, debe encontrar la salida del laberinto.

	Es por esta razón que se opto por realizar un proyecto que sirva para aprender los temas de la asignatura \emph{Laboratorio de microcomputadores} y pueda representar al \emph{Club de Robótica} en la competencia anual.

	Cabe aclarar, la elección del nombre \emph{TCO}, esta inspirado en el personaje de la mitología griega \emph{Teseo}, quien logró salir de un laberinto luego de derrotar al Minotauro.

\vspace{5mm}
\section{Objetivo}
	
	Por las razones planteadas anteriormente, se plantió como objetivo de este trabajo la fabricación de un robot capaz de salir de un laberinto por sus propios medios. 

\newpage

\section{Descripción general}

\subsection{Robot}
	Para llevar a cabo este proyecto se fabricó un robot. El mismo esta compuesto de las siguientas partes.

\begin{itemize}

\item Microcontrolador: Se eligió un ATMega16 de AVR. Este microcontrolador de AVR, muy sensillo, tiene la cantidad justa de períferícos necesaria para la realización de este proyecto. 
\item Motores: Se eligieron dos motores de la marca pololu. Estos tiene encoders integrados, lo que facilita un mejor control del desplazamiento.
\item Puente H LMD18200: Este puente H simple, maneja cargas de hasta 3 Ampere y flag de advertencia de alta temperatura.
\item Sensores HC - SR04: Estos sensores de distancia por ultrasonido, sencillos de utilizar, y muy estables, detectan distancia en un rango de 2 cm a 450 cm, con un margen de error de 0,3 cm.
\item Sensores CNY70: Estos sensores opticos, se utilizan para detectar si el piso es de color negro o blanco. En este caso, se utilizaran para saber si el robot llegó al final del laberinto.
\item Baterías y fuente de alimentación: El robót cuenta con 3 baterías de Li-ion, 2 de 7,2 v y 1 de 3,7 v. Junto con dos fuentes DC/DC de texas proporcionand 12 v y 5 v.

%\begin{figure}[H]
%  \centering
%    \includegraphics[width=0.7\textwidth]{img/TCO-calidad.eps}
%  \caption{Texto abajo de la foto}
%\end{figure}


\end{itemize}

	
\subsection{Laberinto}
	El laberinto fue fabricado como módulos encastrables con únidad minima modelizable como una matriz perteneciente a $\mathbb{R}^{3x3}$, donde las paredes internas del mismo, definen \emph{celdas} que se pueden interpretar como posiciones dentro de la matriz.
	
	El mismo se contruyó con paredes color blanco y piso color negro, dividiendo cada celda por una linea blanca, porque sobre este color es óptimo el rebote de luz infrarroja para los sensores del piso, en el cual las marcas blancas sobre fondo negro dan un gran constraste, lo que se traduce en un marcado cambio de nivel en la señal de salida, y facilita la detección.
	
%\begin{figure}[H]
%  \centering
%    \includegraphics[width=0.7\textwidth]{img/laberinto.eps}
%  \caption{Texto abajo de la foto}
%\end{figure}

\subsection{Algoritmo}
	

\newpage
\section{Resumen de funcionamiento}	

\subsection{PWM y Motores}

\subsection{Funcionamiento de los encoders}

\subsection{Medición de distancia}

Para medir la distancia del robot a las paredes utilizamos tres módulos HC-SR04, los mismos funcionan por ultrasonido.

Elegimos este sensor por varios razones:
\begin{itemize}
\item Su rango de 2 centímetros a 4 metros, ideal para las distancias que necesitamos medir
\item Su resolución nos pareció adecuada (aproximadamente 0.3cm).
\item Simplicidad y costo reducido.
\end{itemize}

Desconocemos de la circuiteria interna de este módulo y lo tratamos más bien como a una caja negra con la cual podemos interactuar mediante
sus pines de E/S.\\

El HC-SR04 además de sus pines para alimentación (VCC y GND) tiene otros dos pines: Trigger y Echo. Para obtener una medición el modulo solo 
requiere un pulso de $10 \mu S$ en su pin Trigger, luego el módulo devuelve un pulso por el pin de Echo con un tiempo en alto 
proporcional a la distancia medida.\\

En nuestro código configuramos una interrupción para que se active con cada desbordamiento del timer/contador1, la cual en cada iteración 
incrementa en 1 la variable \textbf{interrupciones\_timer\_1}. También configuramos los pines Echo y Trigger como entrada y salida respectivamente.\\

Para obtener una medición lo primero que hacemos es enviar el antedicho pulso de $10 \mu S$ al pin de Trigger, luego esperamos con un ciclo ``while'' 
a obtener un ``uno'' en pin de Echo , acto seguido tomamos el valor actual del contador/timer1 y lo guardamos en variable \textbf{cuentas\_inicial}. 
A continuación esperamos a que el pin de Echo vuelva a cero con otro ciclo ``while'' y guardamos el valor del registro del contador/timer1 en otra variable 
llamada \textbf{cuentas\_final}.

Luego, teniendo en cuenta que el timer1 fué configurado para que desborde a las 256 cuentas, para obtener el número total de cuentas 
utilizamos el siguiente código:\\

\begin{lstlisting}
cuentas = (256 - cuentas_inicial) + 256 * interrupciones_timer_1 + cuentas_final;
\end{lstlisting}

Finalmente realizamos una conversión de modo tal que podamos relacionar las cuentas con una distancia aproximada.

\subsection{Identificación del color del piso}

Con el objetivo de detectar la celda blanca que le indica al robot que salió correctamente del laberinto,
se utilizaron tres sensores detectores de color en la parte baja del mismo.
Los sensores utilizados son CNY70 , los mismos se componen de un emisor (led infrarrojo) y un receptor (transistor TBJ NPN).

Estos sensores pueden ser encendidos y apagados a voluntad por el microcontrolador.

Cuando el robot está situado en una celda blanca (salida) la luz emitida por el led del sensor se refleja en la 
superficie y excita la base del transistor permitiendo de esta forma un flujo de corriente de emisor a colector.

Debido a que el microcontrolador sólo puede detectar cambios de tensión ubicamos un resistor entre el emisor del transistor 
y la referencia del circuito (GND); luego obtenemos nuestra tensión en el emisor.

En la hoja de datos del ATmega16 se especifica que la máxima tensión admisible para un cero lógico (con el pin configurado como entrada ) 
es de $0.2 \times VCC$ , en nuestro caso $VCC= 5 V$ $\Rightarrow$ $V_{IL_{max}}=1 V$ por lo tanto una tensión que no supere 1 Volt
será considerada como un cero logico.
Luego $V_{IH_{min}}=0.6\times VCC=0.6\times5V=3V$ (mínima tensión para detectar un uno lógico en un pin configurado como entrada).

Cuando un sensor es situado sobre una celda blanca la tensión en su emisor alcanza los 4.5 V, por lo tanto a efectos del microcontrolador
es un uno lógico.
Cuando el sensor esta ubicado sobre una celda negra la tensión medida es aproximadamente cero, ya que la luz no es reflejada en esta
superficie (interpretado como cero logico).

El microcontrolador enciende los sensores durante un tiempo muy corto cada vez que el robot decide girar a su derecha, de esta forma 
impedimos que se malinterpreten las líneas blancas que dividen las celdas como la salida del laberinto y además evitamos derrochar 
corriente que estaría siendo drenada constantemente por los leds infrarrojos de los CNY70 (aprox $20mA$ por sensor).


\subsection{Comunicación serie}


\newpage
\section{Desarrollo del proyecto}

\subsection{Decisiones de diseño}

\subsection{Armado del robot}

\subsection{Problemas hallados}

\subsection{Experiencia competencia Megaman 2013}


\newpage
\section{Conclusiones}

Bibliografía.
Apéndice: Planos. Listas de componentes. Herramientas utilizas. Algún video del funcionamiento.


	

	
	
\newpage

\section{Listado de componentes}

\subsection{Robot}

\begin{tabular}{|l|r|r|r|r|}\hline
	{\bf Referencia}	 &	{\bf Descripción}	 &{\bf Cantidad} &	{\bf Precio unitario} & {\bf Total} \\			
\hline		
	R11, R9, R10&1.5k & 3    &    &    	\\
\hline      
      	R19, R12, R13, R14, R18&100&  5&    & 	\\    
\hline      
	C3& 100n&  1&    &    \\
\hline      
	C2, C1& 100u&  2&    &     \\ 
\hline
     	C6,C7,C8 & 10u & 3 & & \\	   
\hline      
	RV2, R1, R2, R3, R4, R5, R6, RV1 & 10k&  8&    &      \\
\hline      
	D1, D2, D3, D4, D6, D7, D8,D9  & 1N4148&  8&    &   \\    
\hline      
	C5&  22u&  1&    &       \\
\hline      
	R15, R16,R17 & 330&  3&    &    \\    
\hline      
	R8&  390&  1&    &       \\
\hline      
	R7& 4.7K&  1&    &     \\  
\hline      
	C4&  470n&  1&    &     \\   
\hline      
	Q3, Q1, Q2& BC548&  3&    &   \\    
\hline
	IC1&C8051F330D&  1&    &       \\
\hline      
	U4, U3&  CNY70&  2&    &      \\
\hline      
	P1&CON. BAT&  1&    &       \\
\hline      
	P7& CONN\_1&  1&    &      \\
\hline      
	D10&   IR1&  1&    &        \\
\hline   
   	D11&   IR2&  1&    &        \\
\hline      
	D12&  IR3&  1&    &       \\
\hline      
	K1&IRU101533&  1&    &      \\ 
\hline      
	k4, k2, k3&  ISU60&  3&     &   \\    
\hline      
	U2&  L298D&  1&    &      \\
\hline      
	D5&  LED\_1&  1&    &     \\
\hline     
	U1& LM2940&  1&    &       \\
\hline      
	P3& MOTOR\_L&  1&    &      \\
\hline     
	P4& MOTOR\_R&  1&    &      \\
\hline     
	P2& PROG&  1&    &      \\
\hline   
   	SW1& RE-TRANS&  1&    &    \\   
\hline   
   	P5& RF\_EMIT&  1&    &        \\
\hline 
 	P8& SENS PLACA&  1&    &       \\
\hline 
 	P9&  SENS uC&  1&    &       \\
\hline 
 	SW2&  SW\_PUSH&  1&    &       \\
\hline 
 	P10&SWITCH\_GRAL&  1&    &       \\
\hline   
   	P6&   Tx/Rx&  1&    &     \\\hline
\end{tabular}


\newpage
\section{Herramientas de software}

\begin{itemize}

\item \href{http://kicad.sourceforge.net/wiki/index.php/Main_Page}{KiCAD (Build: 20100406 SVN-R2508)-final: Diseño de esquemáticos y ruteo de placas}
\item CuteCom (v0.22.0): Captura de datos por puerto serie (S.O. Linux - Ubuntu)
\item \LaTeX Lenguaje para paginado de este informe

\end{itemize}


%\newpage

\section{Bibliografía}

\begin{itemize}

\item \href{http://www.scribd.com/doc/13138464/The-8051-Micro-Controller-Book-by-Scott-Mackenzie-Online}{I.Scott Mackenzie, "The 8051 Microcontroller",Prentice Hall, 1995}
\item \href{datasheets/C8051F33x.pdf}{Datasheet del Microcontrolador 8051F330}
\item \href{infoalgoritmo/InteligenciaArtificialyRedesNeuronales.pdf}{M. Daniela López De Luise,"Inteligencia Artificial y Redes Neuronales", EnterpriseWare SRL, Junio de 2001}
%\item \href{infoalgoritmo/TheFloodfill.pdf}{The Flood-fill Algorithm ()}
%\item \href{infoalgoritmo/backtracking}{El Esquema Algorítmico del Backtracking}
\end{itemize}

\section{Apéndice}

\subsection{Esquemáticos:}

\begin{itemize}

\item \href{robotesquematico.pdf}{Esquematico versión pdf}
%\item \href{diseno/placa_robot.pro}{Esquematico y board en versión KiCAD}

\end{itemize}

\subsection{Links útiles:}

\begin{itemize}
\item \href{http://en.wikipedia.org/wiki/Maze_solving_algorithm}{Wikipedia - Resumen de los algoritmos más conocidos 
para resolución de laberintos}
\item \href{http://www.micromouseinfo.com/}{Página dedicada a competencias de \emph{Micromouse} (Resolvedores de laberintos)}
\item \href{http://sensorwiki.org/doku.php}{Referencia a un gran número de sensores diferentes}
\item \href{http://www.societyofrobots.com}{Página dedicada a la robótica en general}
\end{itemize}

\subsection{Diagrama en bloques (*)}

\subsection{Diagrama de flujo (*)}

\subsection{Código fuente (*)}

\small *Ver páginas adjuntas a este informe.

\end{document}
