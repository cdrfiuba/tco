\documentclass[a4paper,12pt]{article}	%Hoja A4, tamaño de letra 12 puntos
\usepackage[latin1]{inputenc}		%Encoding del archivo de texto plano (txt), así podés escribir letras con diacríticas 
\usepackage[T1]{fontenc}		%Encoding de la fuente
\usepackage[spanish]{babel} 		%Estilos, hyphenation y nombres de entornos (abstract-->resumen) en español
\usepackage{times}			%Para agregar la fecha al documento		
\usepackage{amsmath}			%Simbolos matemáticos que sino no funcionan
\usepackage{amssymb}             	%Simbolos matemáticos que sino no funcionan
\usepackage{amsfonts}            	%Fuentes extras para modo mátemático
\usepackage{units}               	%Para agregar unidades y fracciones con formato especial
\usepackage{esint}               	%Para integrales dobles cerradas
%\usepackage{wasysym}            	%Para integrales dobles cerradas (no tan lindo como las de `esint')
%\usepackage{pdfpages}			%Para incluir otros pdfs, en un nuestro documento Latex
%\usepackage{eso-pic}
%\usepackage{everyshi}
%\usepackage{ifthen}
%\usepackage{calc}
%\usepackage{watermark}          	%Permite incluir marcas de agua
\usepackage{float}               	%Permite fijar una figura a un lugar específico del archivo con el parámetro [H] 
\usepackage{fancyhdr}			%Manejo enriquecido de encabezados y pie de página
\usepackage{fancybox}            	%Permite agregar marcos especiales en las páginas
%\usepackage{anysize}			%Habilita el comando \marginsize{left}{right}{top}{bottom}
%\usepackage{mathptmx}			%Tipografía Times
\usepackage[hang,bf]{caption2}		%Numerar subsection
\usepackage{subfigure}
\usepackage{graphicx}
%\usepackage[pdflatex]{graphicx}	%Permite incluir imágenes en el documento. Usando ``dvipdfm'' se pueden manejar archivos jpg, jpeg, png, y pdf. Pero hay que generar un archivo .bb que contiene el tamaño de la imagen entre otros datos. Para eso miktex-->bin-->ebb.exe 
\usepackage{threeparttable}		%Permite agregar notas al pie en tablas
\usepackage{cancel}			%Permite tachar cosas en modo matemático
					%hyperref posibilita referencia internas y externas, a continuacion las opciones de config:
\usepackage[a4paper,
         	dvipdfm,             	%Usar sólo si después se va a pasar de dvi a pdf
		%dvips,%		%Usar si se va a trabajar en dvi, o si después se va a pasar de dvi a ps (y eventualmente de ps a pdf ---pero ojo que los enlaces quedan más lindos si se pasa directamente de dvi a pdf, usando dvipdfm)
		pdfdisplaydoctitle=true,%Muestra el título en el marco superior de la ventana del visor de pdf
		colorlinks=true,     	%Al encender esta función, ya nohay recuadros feos alrededor de los links
		pdfnewwindow=true,   	%Para que el link a nuevos pdf, no se abran en la misma ventana
		linkcolor=black,     	%Color para links internos
		citecolor=green,     	%Color para links a Bibliografia
           	filecolor=blue,      	%Color para links a archivos
		pdftitle={Proyecto (66.09) [Junio 2010] - Robótica Colaborativa},
		pdfauthor={Manuel I. Fernandez, Marcela F. Luberto y Sebastián García Marra}]
		{hyperref}

\usepackage{color}				
\usepackage{listings}		%Este paquete es para poder insertar codigo en el informe y su respectivo set
\lstset{ 
language=C++,                	% choose the language of the code
basicstyle=\footnotesize,       % the size of the fonts that are used for the code
numbers=left,                   % where to put the line-numbers
numberstyle=\footnotesize,      % the size of the fonts that are used for the line-numbers
stepnumber=1,                   % the step between two line-numbers. If it is 1 each line will be numbered
numbersep=5pt,                  % how far the line-numbers are from the code
backgroundcolor=\color{white},  % choose the background color. You must add \usepackage{color}
showspaces=false,               % show spaces adding particular underscores
showstringspaces=false,         % underline spaces within strings
showtabs=false,                 % show tabs within strings adding particular underscores
frame=single,         		% adds a frame around the code
tabsize=2,         		% sets default tabsize to 2 spaces
captionpos=b,           	% sets the caption-position to bottom
breaklines=true,        	% sets automatic line breaking
breakatwhitespace=false,    	% sets if automatic breaks should only happen at whitespace
escapeinside={\%*}{*)}          % if you want to add a comment within your code
}
					


\newcommand{\autor}[3]{\vspace{5mm}%
											{\bf #1}\\%
											{\bf Padrón:} #2\\%
											\texttt{#3}\\}


%Determinación del estilo de página (encabezado y pie)

\lhead{\small Proyecto (66.09) [Junio 2013]}
\chead{}
\rhead{\small TCO}
\rfoot{}
\cfoot{Página {\thepage}}
\lfoot{}

%Manejo de márgenes

%\marginsize{left}{right}{top}{bottom}
\addtolength{\textwidth}{2cm}  		%Agrega 2cm al ancho por defecto (usado junto con hoffset, no se pierde el centrado)
\addtolength{\hoffset}{-1cm}   		%Quita 1cm al margen, pero mantiene la relación repecto de cada margen
\addtolength{\textheight}{2cm}
\addtolength{\voffset}{-1cm}
\setlength{\headheight}{14pt}


%Manejo de contadores (counters)

%\setcounter{tocdepth}{2}		%Profundidad de la aparición de las secciones en el índice:
					%-1 Part, 0 Chapter, 1 Section, 2 Subsection, 3 Subsubsection, 4 Titled

\setcounter{secnumdepth}{1}  		%Profundidad en la enumeración de las secciones:
%-1 Part, 0 Chapter, 1 Section, 2 Subsection, 3 Subsubsection, 4 Titled paragraph, 5 Titled subparagraph %paragraph, 5 Titled subparagraph


%==================================== Comienzo del documento ===================================
 
\begin{document}	
					
%========================================== Caratula ===========================================

\pagestyle{fancy}

	
%===============================================================================================

%=========================================== Presentación ======================================

\newpage
%Empiezo la caratula
\setlength{\unitlength}{0.5 cm}
\thispagestyle{empty}
\begin{figure}[H]
  \centering
    \includegraphics[width=0.5\textwidth]{img/fiuba.eps}
  %\caption{Texto abajo de la foto}
\end{figure}
\vspace{2cm}
\begin{center}
\textbf{\LARGE Laboratorio de Microcomputadoras [66.09]}\\
\vspace{1cm}
{\Large \textbf{ Proyecto TCO\\[1.25cm]}}
\begin{figure}[H]
  \centering
    \includegraphics{img/portada.eps}
  %\caption{Texto abajo de la foto}
\end{figure}
\vspace{1cm}
{\textbf{Primer Cuatrimestre 2013\\[1.25cm]
}}
%\vspace{1cm}
\begin{tabbing}
\hspace*{3cm} \= \hspace*{3cm} \= \hspace*{3cm}\= \hspace*{3cm} \kill
\textbf{Apellido} \> \textbf{Nombre} \> \textbf{Padrón} \> \textbf{Mail} \\
 \>  \>  \>  \\
Carballeda \> Ignacio L. J. \>  91646\> carballeda.ignacio@gmail.com\\
Cerone \> Sebastian \>  90259 \> sebascerone@gmail.com\\
Farace \> Gisela \>  92457 \> gisela.farace@gmail.com\\

\end{tabbing}
\end{center}
\newpage

%===============================================================================================

%=========================================== Indice ============================================
\newpage

\tableofcontents							

\newpage

%=========================================== Informe ===========================================

\section{Motivación}

Este desarrollo surge como un proyecto extracurricular del \emph{Club de Robótica} de la \emph{Facultad de Ingeniería de la Universidad de Buenos Aires} a realizarse dentro del ámbito del \emph{Laboratorio Abierto (LABI)}.

Desde el año 2011, el \emph{Club de Robótica} realiza una competencia anual de robótica. 
En un primer momento, empezó con una carrera de robots velocistas; que consiste en que un robot realice por sus propios medios, en el menor tiempo posible, un recorrido delimitado por una línea blanca sobre una superficie negra. 
Al año siguiente, se incorporó la competencia de "Mini-sumo"; en donde dos robots se enfrentan, cual luchadores de sumo, y deben empujar al oponente fuera del "tatami". 
Finalmente, este año, se incorporó la categoría "Laberinto", en donde un robot, en el menor tiempo posible, debe encontrar la salida de un laberinto.

Es por esta razón, que se opto por realizar un proyecto que sirva para aprender los temas de la asignatura \emph{Laboratorio de microcomputadores} y pueda representar al \emph{Club de Robótica} en la competencia anual.

Cabe aclarar, la elección del nombre \emph{TCO}, está inspirado en el personaje de la mitología griega \emph{Teseo}, quien logró salir de un laberinto luego de derrotar al Minotauro.

\vspace{5mm}
\section{Objetivo}
	
Por las razones planteadas anteriormente, el objetivo de este trabajo es el diseño, fabricación y programación de un robot capaz de salir de un laberinto por sus propios medios. 

\newpage

\section{Descripción general}

\subsection{Robot}

\begin{figure}[H]
  \centering
    \includegraphics[width=0.7\textwidth]{img/diagrama.eps}
  \caption{Diagrama de bloques del robot.}
\end{figure}

Para llevar a cabo este proyecto se fabricó un robot. El mismo esta compuesto de las siguientas partes:

\begin{itemize}

\item Microcontrolador: Se eligió un \emph{ATMEGA16} de \emph{AVR}. Este microcontrolador, muy sencillo, tiene la cantidad adecuada de períferícos necesarios para la realización de este proyecto. 
\item Motores: Se optó por dos motores de la marca \emph{pololu}. Éstos tienen encoders integrados, que facilitan un mejor control del desplazamiento.
\item Puente H LMD18200: Este puente H simple, maneja cargas de hasta 3 Amperes y posee un flag de advertencia de alta temperatura.
\item Sensores HC - SR04: Estos sensores de distancia por ultrasonido, sencillos de utilizar, y muy estables, detectan distancia en un rango de 2 cm a 450 cm, con un margen de error de 0,3 cm.
\item Sensores CNY70: Estos sensores ópticos, se utilizan para diferenciar el color del piso entre blanco o negro. En este caso, se utilizarán para detectar si el robot llegó al final del laberinto.
\item Baterías y fuente de alimentación: El robót cuenta con 3 baterías de Li-ion, 2 de 7,2 v y 1 de 3,7 v. Junto con dos fuentes DC/DC de texas proporcionando 12 v y 5 v.


\begin{figure}[H]
  \centering
    \includegraphics[width=0.7\textwidth]{img/TCO.eps}
  \caption{TCO}
\end{figure}


\end{itemize}

	
\subsection{Laberinto}
	El laberinto se fabricó como un módulo modelizable como una matriz perteneciente a $\mathbb{R}^{3x3}$, donde sus paredes internas, definen \emph{celdas} que se pueden interpretar como posiciones dentro de la matriz.
	
	El mismo se contruyó con paredes color blanco y piso color negro, dividiendo cada celda por una línea blanca, siendo que sobre este color el rebote de luz infrarroja resulta óptimo para los sensores del piso, y facilita la detección entre una celda y otra.
	
\begin{figure}[H]
  \centering
    \includegraphics[width=0.7\textwidth]{img/laberinto.eps}
  \caption{Laberinto}
\end{figure}


\newpage
\subsection{Algoritmo}

\begin{figure}[H]
  \centering
    \includegraphics[width=0.7\textwidth]{img/diagrama_flujo_algoritmo.eps}
    \caption{Laberinto}
\end{figure}	

\newpage
\section{Resumen de funcionamiento}	

\subsection{PWM y Motores}

\subsection{Funcionamiento de los encoders}

\subsection{Medición de distancia}

Para medir la distancia del robot a las paredes se utilizaron tres módulos \emph{HC-SR04}, los mismos funcionan por ultrasonido.

Se eligieron estos sensores por varias razones:
\begin{itemize}
\item Su rango de 2 centímetros a 4 metros.
\item Su resolución de 3 milímetros.
\item Simplicidad y costo reducido.
\end{itemize}

Se desconoce la circuitería interna del mismo, por lo que será tratado como a una caja negra con el cual se puede interactuar mediante
sus pines de Entrada/Salida.\\

El HC-SR04 además de sus pines para alimentación (VCC y GND), tiene otros dos pines: Trigger y Echo. Para obtener una medición, el módulo sólo 
requiere un pulso de $10 \mu S$ en el pin Trigger, luego el módulo pone en alto el pin de Echo con un tiempo proporcional a la distancia medida.\\

En el código fuente de este proyecto, se configuró una interrupción para que se active con cada desbordamiento del \emph{timer/contador1}. Esta interrupción en cada iteración incrementa en 1 la variable \textbf{interrupciones\_timer\_1}. También se configuran los pines Echo y Trigger como entrada y salida respectivamente.\\

Para obtener una medición, primero se pone en alto el pin de Trigger por un tiempo mayor a $10 \mu S$, luego se espera con un ciclo ``while'' 
a obtener un ``uno'' en pin de Echo; acto seguido se toma el valor actual del contador/timer1 y se guarda en la variable \textbf{cuentas\_inicial}. 
A continuación, se espera a que el pin de Echo vuelva a cero con otro ciclo ``while'' y se guarda el valor del registro del contador/timer1 en otra variable llamada \textbf{cuentas\_final}.

Luego, teniendo en cuenta que el timer1 fué configurado para que desborde a las 256 cuentas; para obtener el número total de cuentas 
se utiliza el siguiente código:\\

\begin{lstlisting}
cuentas = (256 - cuentas_inicial) + 256 * interrupciones_timer_1 + cuentas_final;
\end{lstlisting}

Finalmente se realiza una conversión para relacionar las cuentas con una distancia aproximada.
\vspace{5mm}


\subsection{Identificación del color del piso}

Con el objetivo de detectar la celda blanca, se utilizaron tres sensores detectores de color en la parte baja del mismo, que le indican al robot que salió correctamente del laberinto.
Los sensores utilizados son los \emph{CNY70}, compuestos por un emisor (led infrarrojo) y un receptor (transistor TBJ NPN).

Estos sensores pueden ser encendidos y apagados a voluntad por el microcontrolador.

Cuando el robot está situado en una celda blanca (salida), la luz emitida por el led del sensor se refleja en la superficie y excita la base del transistor, permitiendo de esta forma un flujo de corriente de emisor a colector.

Se ubicó un resistor entre el emisor del transistor y la referencia del circuito (GND), para detectar los cambios de tensión.

En la hoja de datos del \emph{ATMEGA16} se especifica que la máxima tensión admisible para un cero lógico (con el pin configurado como entrada), es de $0.2 \times VCC$ , en nuestro caso $VCC= 5 V$ $\Rightarrow$ $V_{IL_{max}}=1 V$. Por lo tanto una tensión que no supere 1 Volt, será considerada como un cero logico.
Por otro lado, $V_{IH_{min}}=0.6\times VCC=0.6\times5V=3V$ es la mínima tensión para detectar un uno lógico en un pin configurado como entrada.

Cuando un sensor es situado sobre una celda blanca, la tensión en su emisor alcanza los 4.5 V, valor considerado por el microcontrolador como un ''uno'' lógico. En cambio, ubicado sobre una celda negra, la tensión medida es aproximadamente cero, ya que la luz no es reflejada en esta
superficie y esto es interpretado como cero lógico.

El microcontrolador enciende los sensores durante un tiempo muy breve cada vez que el robot decide girar a su derecha, de esta forma 
se evita que las líneas blancas que dividen las celdas sean interpretadas como la salida del laberinto.
\vspace{5mm}

\subsection{Comunicación serie}


\newpage
\section{Desarrollo del proyecto}

\subsection{Decisiones de diseño}

\subsection{Armado del robot}

\subsection{Problemas hallados}

\subsection{Experiencia competencia Megaman 2013}


\newpage
\section{Conclusiones}
	
	
\newpage

\section{Listado de componentes}

\subsection{Robot}

\begin{tabular}{|l|r|r|r|r|}\hline
{\bf Referencia}	 &	{\bf Descripción}	 &{\bf Cantidad} &	{\bf Precio unitario} & {\bf Total} \\			
\hline		
	C3, C9, C11 			& 100 nF	& 3	&	&    	\\
\hline      
      	C25				& 100 uF	& 1	&    	& 	\\    
\hline      
	C14, C15, C18, C19		& 10 n 		&  4	&    	&    	\\
\hline      
	C4, C5, C6, C7, C8, C13, C17	& 1 uF		& 7	&    	&     	\\ 
\hline
     	C1, C12 			& 12 p 		& 2 	& 	& 	\\	   
\hline      
	C12, C16 			& 220 uF	& 2	&    	&      	\\
\hline      
	C20, C21 			& 2,2 uF	& 2	&    	&      	\\
\hline      
	C23				& 330 uF	& 1	&    	&   	\\    
\hline      
	R1				& 10 k		& 1	&    	&   	\\    
\hline      
	R11				& 21 k		& 1	&    	&       \\
\hline      
	R10 				& 732		& 1	&    	&    	\\    
\hline      
	R2, R3, R4, R5, R6, R7		& R		& 6	&    	&     	\\    
\hline      
	X1				& 8 MHz		& 1	&    	&       \\
\hline      
	IC1				& ATMEGA16-A	& 1	&    	&     	\\    
\hline      
	U1				& MAX232	& 1	&    	&     	\\  
\hline      
	U2				& PTN78000W	& 1	&    	&     	\\  
\hline      
	U3				& PTN78020W	& 1	&    	&     	\\    
\hline      
	Puente1, Puente2		& LMD18200	& 2	&    	&     	\\    
\hline      
	L1				& Inductor	& 1	&    	&     	\\  
\hline      
	Conector 2x1			& Conector 2x1	& 7	&    	&     	\\   
\hline      
	Conector 3x2			& Conector 3x2	& 1	&    	&   	\\    
\hline
	Conectores			& Conectores 	& 9   	&       &	\\
\hline      
	SW1, SW2, 			& Pulsador NA	& 2	&    	&     	\\    
\hline      
	SW3				& Llave dos vias& 1	&    	&     	\\    
\hline      
	Q1				& NPN		& 1	&    	&     	\\  
\hline    

\end{tabular}


\newpage
\section{Herramientas de software}

\begin{itemize}

\item \href{http://kicad.sourceforge.net/wiki/index.php/Main_Page}{KiCAD (Build: 20100406 SVN-R2508)-final: Diseño de esquemáticos y ruteo de placas}
\item CuteCom (v0.22.0): Captura de datos por puerto serie (S.O. Linux - Ubuntu)
\item \LaTeX Lenguaje para paginado de este informe

\end{itemize}


%\newpage

\section{Bibliografía}

\begin{itemize}

\item \href{http://www.scribd.com/doc/13138464/The-8051-Micro-Controller-Book-by-Scott-Mackenzie-Online}{I.Scott Mackenzie, "The 8051 Microcontroller",Prentice Hall, 1995}
\item Datasheet del Microcontrolador ATMEGA16
\end{itemize}

\section{Apéndice}

\subsection{Esquemáticos  (*)}

\subsection{Código fuente (*)}

\small *Ver páginas adjuntas a este informe.

\end{document}
